<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- remove once seo tags set og:type -->
    <meta property="og:type" content="website" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Microservices are hard | ahiravan.dev</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Microservices are hard" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Microservices are hard" />
<meta property="og:description" content="Microservices are hard" />
<meta property="og:site_name" content="ahiravan.dev" />
<meta property="og:image" content="/assets/favicon.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="/assets/favicon.png" />
<meta property="twitter:title" content="Microservices are hard" />
<meta name="twitter:site" content="@ahiravan1" />
<meta name="twitter:creator" content="@ahiravan1" />
<script type="application/ld+json">
{"description":"Microservices are hard","headline":"Microservices are hard","dateModified":"2020-05-14T00:00:00+00:00","datePublished":"2020-05-14T00:00:00+00:00","@type":"Person","image":"/assets/favicon.png","url":"/2020/05/14/micorservices-are-hard.html","name":"Ahiravanâ€™s portfolio","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/favicon.png"}},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" type="image/png" href="/assets/favicon.png">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    <link rel="stylesheet" type="text/css" href="/assets/common.css">
    <link rel="stylesheet" type="text/css" href="/assets/light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link rel="stylesheet" type="text/css" href="/assets/dark.css" media="(prefers-color-scheme: dark)">
       <link rel="preload" href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap" as="style">
         <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-166104383-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166104383-1');
</script>
</head><body class="container Site"><header>
  <nav class="navbar menu1 is-transparent" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
    <svg width="2em" height="2em" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024" xml:space="preserve">
<path id="svg-logo" d="M821.37 237.66L821.37 842.48Q821.37 883.95 769.9 923.98Q718.43 962.59 644.07 986.9L592.6 1005.48L609.76 974.03Q621.2 951.15 624.06 935.42Q641.21 881.09 641.21 842.48L641.21 506.47Q641.21 482.16 609.76 466.43Q578.3 450.71 529.69 450.71Q483.93 450.71 451.05 467.86Q418.16 483.59 418.16 506.47L418.16 842.48Q418.16 898.25 438.18 951.15Q441.04 959.73 449.62 974.03L466.77 1005.48L415.3 986.9Q369.55 965.45 326.65 944Q238 891.1 238 842.48L238 237.66Q238 189.05 306.63 137.57Q329.51 120.41 380.98 94.68L443.9 66.08L418.16 106.11Q401 126.13 401 159.02Q401 174.75 405.29 184.76Q409.58 193.33 423.88 204.77Q458.2 226.22 529.69 226.22Q604.04 226.22 631.21 207.63Q658.37 187.62 658.37 159.02Q658.37 137.57 654.08 126.13Q649.79 113.26 644.07 106.11L618.34 66.08L678.39 94.68Q718.43 114.69 749.88 137.57Q821.37 190.48 821.37 237.66ZM529.69 249.1Q483.93 249.1 451.05 266.26Q418.16 281.98 418.16 304.86L418.16 372.06Q418.16 396.37 449.62 412.1Q481.07 427.83 529.69 427.83Q578.3 427.83 609.76 412.1Q641.21 396.37 641.21 372.06L641.21 304.86Q641.21 280.55 609.76 264.83Q578.3 249.1 529.69 249.1Z"/>
</svg>
    
    <h5 class="title is-5" style="margin-left: 0.5em;">  Ahiravan </h5>
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicExample" class="navbar-menu">

    <div class="navbar-end"><div class="navbar-item">
        <a href="/">/me</a>
        </div><div class="navbar-item">
        <a href="/work">/work</a>
        </div><div class="navbar-item">
        <a href="/blog">/blog</a>
        </div><div class="navbar-item">
        <a href="/more">/more</a>
        </div><div class="navbar-item">
  </div>
    </div>
  </div>
</nav>
</header>

<main class="Site-content">
        <section class="section">
            <div class="content">
                <h1 id="microservices-are-hard">Microservices are hard</h1>

<h4 id="rant">/rant</h4>

<p>Random day today like all other days but there was this idea still fresh in my mind from the yesterdays AWS Summit Online about microservices.
There was a discussion by elara tech and how they have used microservices patterns to scale. Some of mentioned patterns include</p>
<ul>
  <li>ratelimiting</li>
  <li>api gateway</li>
  <li>circuit breaker</li>
  <li>bulk heading</li>
  <li>automatic retyring and caching 
and other resilience techniques.</li>
</ul>

<p>They have 50+ micorservices. In a fictional company I had worked earlier we had 100+ plus microservices.</p>

<p>During a discussion based on a security audit we figured we were not validating the auth token in the graphql layer.
To fix that we were supposed to call auth service from graphql for each request and auth service was slow.
The immediate suggestion was to cache the auth token in redis from graphql along with its expiry during login, refresh them on expiry and bust them on logout.</p>

<p>This call is one of what I call as snowball blunder. These gradually roll up and cause an avalanche. We playfully roll the ice ball without considering its consequences. What can a puffy small snowball do? Splash on your face? Meh.</p>

<ol>
  <li>Arent we implementing auth again in graphql? What is the role of auth then?</li>
  <li>What happens when redis cluster crashes? You implement a fallback or you log the users out?</li>
  <li>Now how do you take care of fallbacks?</li>
</ol>

<p>We had no circuit breaker, we had no bulk heading, we had not thought of fallbacks.
We had a half baked loadbalancer as an api gateway, a half baked caching and we had not thought of retries.</p>

<p>But yeah we are on microservices. If someone asks we can proudly say yeah we are on microservices and even worse have 100s of them.</p>

<p>Although not all hope is lost. We do have a good sense of where we went wrong. We had do to all this because auth was slow.
If only the service was fast we would not have needed any of the above. So lets rewrite it using go.</p>

            </div>
        </section>
    </main><footer>
    <div class="content has-text-centered">
        <small>&copy; Copyright 2020, Ahiravan </small>
        <small>
            <dark-mode-toggle id="dark-mode-toggle" permanent=true light="use dark theme" dark="use light theme">
            </dark-mode-toggle>
        </small>
    </div>
</footer><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
    <script type="text/javascript" src="/assets/ahiravan.js"></script>
    <script type="module" src="/assets/dark-mode-toggle.min.mjs"></script>
</body>

</html>